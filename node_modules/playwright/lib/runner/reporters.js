"use strict";
<<<<<<< HEAD
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var reporters_exports = {};
__export(reporters_exports, {
  createErrorCollectingReporter: () => createErrorCollectingReporter,
  createReporterForTestServer: () => createReporterForTestServer,
  createReporters: () => createReporters
});
module.exports = __toCommonJS(reporters_exports);
var import_path = __toESM(require("path"));
var import_utils = require("playwright-core/lib/utils");
var import_loadUtils = require("./loadUtils");
var import_base = require("../reporters/base");
var import_blob = require("../reporters/blob");
var import_dot = __toESM(require("../reporters/dot"));
var import_empty = __toESM(require("../reporters/empty"));
var import_github = __toESM(require("../reporters/github"));
var import_html = __toESM(require("../reporters/html"));
var import_json = __toESM(require("../reporters/json"));
var import_junit = __toESM(require("../reporters/junit"));
var import_line = __toESM(require("../reporters/line"));
var import_list = __toESM(require("../reporters/list"));
var import_reporterV2 = require("../reporters/reporterV2");
async function createReporters(config, mode, isTestServer, descriptions) {
  const defaultReporters = {
    blob: import_blob.BlobReporter,
    dot: mode === "list" ? ListModeReporter : import_dot.default,
    line: mode === "list" ? ListModeReporter : import_line.default,
    list: mode === "list" ? ListModeReporter : import_list.default,
    github: import_github.default,
    json: import_json.default,
    junit: import_junit.default,
    null: import_empty.default,
    html: import_html.default
  };
  const reporters = [];
  descriptions ??= config.config.reporter;
  if (config.configCLIOverrides.additionalReporters)
    descriptions = [...descriptions, ...config.configCLIOverrides.additionalReporters];
  const runOptions = reporterOptions(config, mode, isTestServer);
  for (const r of descriptions) {
    const [name, arg] = r;
    const options = { ...runOptions, ...arg };
    if (name in defaultReporters) {
      reporters.push(new defaultReporters[name](options));
    } else {
      const reporterConstructor = await (0, import_loadUtils.loadReporter)(config, name);
      reporters.push((0, import_reporterV2.wrapReporterAsV2)(new reporterConstructor(options)));
    }
  }
  if (process.env.PW_TEST_REPORTER) {
    const reporterConstructor = await (0, import_loadUtils.loadReporter)(config, process.env.PW_TEST_REPORTER);
    reporters.push((0, import_reporterV2.wrapReporterAsV2)(new reporterConstructor(runOptions)));
  }
  const someReporterPrintsToStdio = reporters.some((r) => r.printsToStdio ? r.printsToStdio() : true);
  if (reporters.length && !someReporterPrintsToStdio) {
    if (mode === "list")
      reporters.unshift(new ListModeReporter());
    else if (mode !== "merge")
      reporters.unshift(!process.env.CI ? new import_line.default({ omitFailures: true }) : new import_dot.default());
=======

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createErrorCollectingReporter = createErrorCollectingReporter;
exports.createReporterForTestServer = createReporterForTestServer;
exports.createReporters = createReporters;
var _path = _interopRequireDefault(require("path"));
var _utils = require("playwright-core/lib/utils");
var _loadUtils = require("./loadUtils");
var _base = require("../reporters/base");
var _blob = require("../reporters/blob");
var _dot = _interopRequireDefault(require("../reporters/dot"));
var _empty = _interopRequireDefault(require("../reporters/empty"));
var _github = _interopRequireDefault(require("../reporters/github"));
var _html = _interopRequireDefault(require("../reporters/html"));
var _json = _interopRequireDefault(require("../reporters/json"));
var _junit = _interopRequireDefault(require("../reporters/junit"));
var _line = _interopRequireDefault(require("../reporters/line"));
var _list = _interopRequireDefault(require("../reporters/list"));
var _reporterV = require("../reporters/reporterV2");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * Copyright Microsoft Corporation. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

async function createReporters(config, mode, isTestServer, descriptions) {
  const defaultReporters = {
    blob: _blob.BlobReporter,
    dot: mode === 'list' ? ListModeReporter : _dot.default,
    line: mode === 'list' ? ListModeReporter : _line.default,
    list: mode === 'list' ? ListModeReporter : _list.default,
    github: _github.default,
    json: _json.default,
    junit: _junit.default,
    null: _empty.default,
    html: _html.default
  };
  const reporters = [];
  descriptions !== null && descriptions !== void 0 ? descriptions : descriptions = config.config.reporter;
  if (config.configCLIOverrides.additionalReporters) descriptions = [...descriptions, ...config.configCLIOverrides.additionalReporters];
  const runOptions = reporterOptions(config, mode, isTestServer);
  for (const r of descriptions) {
    const [name, arg] = r;
    const options = {
      ...runOptions,
      ...arg
    };
    if (name in defaultReporters) {
      reporters.push(new defaultReporters[name](options));
    } else {
      const reporterConstructor = await (0, _loadUtils.loadReporter)(config, name);
      reporters.push((0, _reporterV.wrapReporterAsV2)(new reporterConstructor(options)));
    }
  }
  if (process.env.PW_TEST_REPORTER) {
    const reporterConstructor = await (0, _loadUtils.loadReporter)(config, process.env.PW_TEST_REPORTER);
    reporters.push((0, _reporterV.wrapReporterAsV2)(new reporterConstructor(runOptions)));
  }
  const someReporterPrintsToStdio = reporters.some(r => r.printsToStdio ? r.printsToStdio() : true);
  if (reporters.length && !someReporterPrintsToStdio) {
    // Add a line/dot/list-mode reporter for convenience.
    // Important to put it first, just in case some other reporter stalls onEnd.
    if (mode === 'list') reporters.unshift(new ListModeReporter());else if (mode !== 'merge') reporters.unshift(!process.env.CI ? new _line.default({
      omitFailures: true
    }) : new _dot.default());
>>>>>>> 0bbb606fffa4286e884fc3bf9391c67f4bdb0fbb
  }
  return reporters;
}
async function createReporterForTestServer(file, messageSink) {
<<<<<<< HEAD
  const reporterConstructor = await (0, import_loadUtils.loadReporter)(null, file);
  return (0, import_reporterV2.wrapReporterAsV2)(new reporterConstructor({
=======
  const reporterConstructor = await (0, _loadUtils.loadReporter)(null, file);
  return (0, _reporterV.wrapReporterAsV2)(new reporterConstructor({
>>>>>>> 0bbb606fffa4286e884fc3bf9391c67f4bdb0fbb
    _send: messageSink
  }));
}
function createErrorCollectingReporter(screen, writeToConsole) {
  const errors = [];
  return {
<<<<<<< HEAD
    version: () => "v2",
    onError(error) {
      errors.push(error);
      if (writeToConsole)
        process.stdout.write((0, import_base.formatError)(screen, error).message + "\n");
=======
    version: () => 'v2',
    onError(error) {
      errors.push(error);
      if (writeToConsole) process.stdout.write((0, _base.formatError)(screen, error).message + '\n');
>>>>>>> 0bbb606fffa4286e884fc3bf9391c67f4bdb0fbb
    },
    errors: () => errors
  };
}
function reporterOptions(config, mode, isTestServer) {
  return {
    configDir: config.configDir,
    _mode: mode,
    _isTestServer: isTestServer,
    _commandHash: computeCommandHash(config)
  };
}
function computeCommandHash(config) {
  const parts = [];
<<<<<<< HEAD
  if (config.cliProjectFilter)
    parts.push(...config.cliProjectFilter);
  const command = {};
  if (config.cliArgs.length)
    command.cliArgs = config.cliArgs;
  if (config.cliGrep)
    command.cliGrep = config.cliGrep;
  if (config.cliGrepInvert)
    command.cliGrepInvert = config.cliGrepInvert;
  if (config.cliOnlyChanged)
    command.cliOnlyChanged = config.cliOnlyChanged;
  if (Object.keys(command).length)
    parts.push((0, import_utils.calculateSha1)(JSON.stringify(command)).substring(0, 7));
  return parts.join("-");
}
class ListModeReporter {
  version() {
    return "v2";
=======
  // Include project names for readability.
  if (config.cliProjectFilter) parts.push(...config.cliProjectFilter);
  const command = {};
  if (config.cliArgs.length) command.cliArgs = config.cliArgs;
  if (config.cliGrep) command.cliGrep = config.cliGrep;
  if (config.cliGrepInvert) command.cliGrepInvert = config.cliGrepInvert;
  if (config.cliOnlyChanged) command.cliOnlyChanged = config.cliOnlyChanged;
  if (Object.keys(command).length) parts.push((0, _utils.calculateSha1)(JSON.stringify(command)).substring(0, 7));
  return parts.join('-');
}
class ListModeReporter {
  constructor() {
    this.config = void 0;
  }
  version() {
    return 'v2';
>>>>>>> 0bbb606fffa4286e884fc3bf9391c67f4bdb0fbb
  }
  onConfigure(config) {
    this.config = config;
  }
  onBegin(suite) {
<<<<<<< HEAD
    console.log(`Listing tests:`);
    const tests = suite.allTests();
    const files = /* @__PURE__ */ new Set();
    for (const test of tests) {
      const [, projectName, , ...titles] = test.titlePath();
      const location = `${import_path.default.relative(this.config.rootDir, test.location.file)}:${test.location.line}:${test.location.column}`;
      const projectTitle = projectName ? `[${projectName}] \u203A ` : "";
      console.log(`  ${projectTitle}${location} \u203A ${titles.join(" \u203A ")}`);
      files.add(test.location.file);
    }
    console.log(`Total: ${tests.length} ${tests.length === 1 ? "test" : "tests"} in ${files.size} ${files.size === 1 ? "file" : "files"}`);
  }
  onError(error) {
    console.error("\n" + (0, import_base.formatError)(import_base.terminalScreen, error).message);
  }
}
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  createErrorCollectingReporter,
  createReporterForTestServer,
  createReporters
});
=======
    // eslint-disable-next-line no-console
    console.log(`Listing tests:`);
    const tests = suite.allTests();
    const files = new Set();
    for (const test of tests) {
      // root, project, file, ...describes, test
      const [, projectName,, ...titles] = test.titlePath();
      const location = `${_path.default.relative(this.config.rootDir, test.location.file)}:${test.location.line}:${test.location.column}`;
      const projectTitle = projectName ? `[${projectName}] › ` : '';
      // eslint-disable-next-line no-console
      console.log(`  ${projectTitle}${location} › ${titles.join(' › ')}`);
      files.add(test.location.file);
    }
    // eslint-disable-next-line no-console
    console.log(`Total: ${tests.length} ${tests.length === 1 ? 'test' : 'tests'} in ${files.size} ${files.size === 1 ? 'file' : 'files'}`);
  }
  onError(error) {
    // eslint-disable-next-line no-console
    console.error('\n' + (0, _base.formatError)(_base.terminalScreen, error).message);
  }
}
>>>>>>> 0bbb606fffa4286e884fc3bf9391c67f4bdb0fbb
